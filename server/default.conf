# Configuration du site par défaut - Serveur vulnérable Raccoon

# Serveur HTTP simple (accessible et fonctionnel)
server {
    listen 80;
    server_name raccoon-server localhost;
    
    root /var/www/html;
    index index.html;
    
    # Headers informatifs
    add_header X-Server-Info "HTTP-Server-For-Testing" always;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Endpoint pour vérifier la configuration
    location /status {
        return 200 'HTTP Server - Raccoon demo accessible\n';
        add_header Content-Type text/plain;
    }
    
    # Endpoint de test
    location /test {
        return 200 'HTTP endpoint working - Use HTTPS for vulnerability testing\n';
        add_header Content-Type text/plain;
    }
    
    # Redirection vers HTTPS pour les tests de sécurité
    location /https-test {
        return 301 https://$server_name:8443/test;
    }
}

# Serveur HTTPS vulnérable (pour les tests Raccoon)
server {
    listen 443 ssl http2;
    server_name raccoon-server localhost;
    
    root /var/www/html;
    index index.html;
    
    # Configuration SSL héritée de nginx.conf
    
    # Headers de sécurité (optionnels pour le test)
    add_header X-Server-Info "TLS-1.2-DHE-Vulnerable" always;
    add_header X-DH-Reuse "Static-DH-Parameters" always;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Endpoint pour vérifier la configuration
    location /status {
        return 200 'TLS 1.2 Server with DH key reuse - Raccoon vulnerable\n';
        add_header Content-Type text/plain;
    }
    
    # Endpoint pour forcer de multiples connexions (utile pour les tests)
    location /test {
        return 200 'Multiple connections will reuse the same DH parameters\n';
        add_header Content-Type text/plain;
    }
    
    # Log des connexions SSL pour analyse
    access_log /var/log/nginx/ssl_access.log;
    error_log /var/log/nginx/ssl_error.log;
}