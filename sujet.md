# TP S√©curit√© : Attaque Raccoon

## Introduction

Ce TP vous permettra de d√©couvrir et d'exp√©rimenter l'**attaque Raccoon**, une vuln√©rabilit√© cryptographique qui exploite la r√©utilisation de cl√©s dans les √©changes Diffie-Hellman (DHE) en TLS.

L'attaque Raccoon tire parti du fait que certains serveurs TLS r√©utilisent la m√™me cl√© priv√©e Diffie-Hellman pour plusieurs connexions, permettant √† un attaquant d'extraire cette cl√© secr√®te en observant suffisamment d'√©changes.

**üìö Pour plus d'informations d√©taill√©es sur cette attaque, consultez : [raccoon-attack.com](https://raccoon-attack.com)**

## Objectifs du TP

- Comprendre les m√©canismes de l'attaque Raccoon
- Exp√©rimenter avec des impl√©mentations vuln√©rables
- Utiliser des outils de r√©duction de r√©seau (lattice) pour retrouver des cl√©s secr√®tes
- Analyser la vuln√©rabilit√© de serveurs TLS

---

## Exercice 1 : Test du script Raccoon

### Installation et pr√©paration

1. **Cloner le d√©p√¥t du TP :**
   ```bash
   git clone https://github.com/HugoSpery/tp-security-raccoon.git
   ```

2. **Se positionner dans le dossier de l'exercice 1 :**
   ```bash
   cd tp-security-raccoon/src/exo1
   ```

3. **V√©rifier le contenu du dossier :**
   ```bash
   ls -la
   ```

### Description de l'exercice

Le script `raccoon.sage` contient l'impl√©mentation de l'attaque Raccoon permettant de r√©cup√©rer la cl√© secr√®te Diffie-Hellman. Cependant, **le script contient des trous que vous devrez compl√©ter** pour qu'il fonctionne correctement.

#### Param√®tres test√©s

Le script teste l'attaque sur diff√©rentes tailles de cl√©s :
- **20 bits** : Tr√®s facile √† casser (d√©monstration)
- **50 bits** : Relativement rapide 
- **100 bits** : Plus difficile mais faisable

Vous pourrez observer la **diff√©rence de temps et de complexit√©** entre chaque taille de cl√©.

#### ‚ö†Ô∏è Note importante sur la simulation

**√Ä titre informatif :** ce script ne s'ex√©cute pas sur un vrai serveur TLS et "triche" dans les calculs. En effet, une attaque r√©elle prendrait √©norm√©ment de temps car :
- Les vrais serveurs utilisent des cl√©s d'au minimum **1024 bits** (voire 2048+ bits)
- L'attaquant devrait mesurer lui-m√™me les timings et construire la matrice de r√©duction
- Le processus de r√©duction de r√©seau serait beaucoup plus long

Cette simulation permet donc de comprendre les **principes th√©oriques** de l'attaque dans un temps raisonnable.

#### Ex√©cution du script

**Pr√©requis :** Avoir SageMath install√© sur votre machine.

**Lancement :**
```bash
sage raccoon.sage
```

#### R√©sultats

Une fois le script termin√©, les **r√©sultats de l'attaque** se trouvent dans le dossier `output/` o√π vous pourrez voir les **cl√©s d√©chiffr√©es** pour chaque test effectu√©.

```bash
cd output/
```

**üìã Questions √† analyser :**

1. Que peut-on en d√©duire sur la s√©curit√© selon la taille des cl√©s ? 

#### üéØ Bonus (optionnel)

Pour aller plus loin, vous pouvez tester l'attaque avec des cl√©s plus grandes :

1. **Ajouter une nouvelle configuration** dans le fichier `common.json` avec une taille de cl√© plus importante (ex: 256 bits, 512 bits)
2. **Instancier cette nouvelle configuration** dans `raccoon.sage` en suivant l'exemple des lignes 197 √† 206
3. **Observer les dur√©es** n√©cessaires pour r√©soudre ces cl√©s plus longues


## Exercice 2 : Serveur web vuln√©rable

### Installation et pr√©paration

‚ö†Ô∏è **Attention :** Cet exercice se fait dans un **vdn**. Il faut recloner le projet.

1. **Cloner √† nouveau le d√©p√¥t du TP :**
   ```bash
   git clone https://github.com/HugoSpery/tp-security-raccoon.git
   ```

2. **Se positionner dans le dossier de l'exercice 2 :**
   ```bash
   cd tp-security-raccoon/src/exo2
   ```

### Description de l'exercice

Dans cet exercice, vous disposez d'un **serveur web malconfigur√©** et sensible √† l'attaque Raccoon. Votre mission est de **modifier la configuration** pour le prot√©ger contre cette attaque.

**üìö Pour comprendre les configurations s√©curis√©es, consultez : [raccoon-attack.com](https://raccoon-attack.com)**

#### Configuration du serveur

La configuration du serveur se trouve dans le fichier `docker-compose.yml`. C'est dans ce fichier que vous devrez apporter les modifications n√©cessaires. 

#### Commandes utiles

**Lancer ou relancer le serveur apr√®s modification :**
```bash
docker-compose up -d --force-recreate dh-reuse-server
```

**Tester la vuln√©rabilit√© du serveur :**
```bash
docker-compose run --rm raccoon-checker bash -lc "cd /work && python3 check_raccoon_vulnerability.py dh-reuse-server 443"
```

**üìã Questions √† analyser :**

1. Quelles sont les diff√©rents probl√®mes de configuration sur ce serveur ? 
2. Quelles est la meilleur configuration possible pour √™tre prot√©g√© au maximum de raccoon ?

## Exercice 3 : D√©chiffrer trame TLS
